@using System.Text.Json;
@model CasoEstudio2.Entities.Casas
@{
    ViewBag.Title = "AlquilarCasas";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="col-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">Información General</h4>

            @if (ViewBag.MensajeUsuario != null)
            {
                <div class="alert alert-info" role="alert" style="text-align:center">
                    @ViewBag.MensajeUsuario
                </div>
            }

            @using (Html.BeginForm("AlquilarCasas", "Casas", FormMethod.Post, new { @class = "pt-3" }))
            {

                @Html.HiddenFor(m => m.IdCasa)
                <div class="form-group">
                    <label for="Test">Casa</label>
                    @Html.DropDownListFor(m => m.DescripcionCasa, ViewBag.Casas as List<SelectListItem>, new { @id = "DescripcionCasa", @class = "form-control form-control-lg", @type = "text", @placeholder = "DescripcionCasa", @required = "true" })

                </div>

                <div class="form-group">
                    <label for="exampleInputName1"> Precio</label>
                    @Html.TextBoxFor(m => m.PrecioCasa, new { @id = "PrecioCasa", @readonly = "@readonly", style = "background-color:#eeeeee", @class = "form-control form-control-lg", @type = "text", placeholder = "Precio" })
                </div>
                <div class="form-group">
                    <label for="exampleInputEmail3">Nombre</label>
                    @Html.TextBoxFor(m => m.UsuarioAlquiler, new { @class = "form-control form-control-lg", @type = "text", placeholder = "Usuario" })
                </div>

                <button type="submit" class="btn btn-primary mr-2">Alquilar</button>
            }

        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Attach a change event listener to the DescripcionCasa dropdown
        document.getElementById('DescripcionCasa').addEventListener('change', function () {
            handleDescripcionCasaChange();
        });

        function handleDescripcionCasaChange() {
            // Get the selected value (IdCasa) from the DescripcionCasa dropdown
            var idCasa = document.getElementById('DescripcionCasa').value;

            // Create a new XMLHttpRequest object
            var xhr = new XMLHttpRequest();

            // Configure the request with the API endpoint and the selected IdCasa
            xhr.open('GET', `https://localhost:7033/api/Casas/ConsultarCasa?IdCasa=${encodeURIComponent(idCasa)}`, true);

            // Set up the onload event handler to process the response
            xhr.onload = function () {
                // Check if the request was successful
                if (xhr.status === 200) {
                    // Parse the JSON response
                    var data = JSON.parse(xhr.responseText);

                    // Extract the price from the response
                    var precioCasa = data.dato ? data.dato.precioCasa : null;

                    // Check if precioCasa is not null and update the PrecioCasa textbox
                    if (precioCasa !== null) {
                        document.getElementById('PrecioCasa').value = precioCasa;
                    }
                } else {
                    // Handle errors
                    console.error('Error fetching casa price:', xhr.statusText);
                    alert('There was an error fetching the price. Please try again.');
                }
            };

            // Set up an error handler
            xhr.onerror = function () {
                console.error('Error fetching casa price:', xhr.statusText);
                alert('There was an error fetching the price. Please try again.');
            };

            // Send the request
            xhr.send();
        }
    });





</script>

